window.__require=function e(t,n,o){function r(c,i){if(!n[c]){if(!t[c]){var s=c.split("/");if(s=s[s.length-1],!t[s]){var u="function"==typeof __require&&__require;if(!i&&u)return u(s,!0);if(a)return a(s,!0);throw new Error("Cannot find module '"+c+"'")}}var l=n[c]={exports:{}};t[c][0].call(l.exports,function(e){return r(t[c][1][e]||e)},l,l.exports,e,t,n,o)}return n[c].exports}for(var a="function"==typeof __require&&__require,c=0;c<o.length;c++)r(o[c]);return r}({index:[function(e,t,n){"use strict";cc._RF.push(t,"f93beDisV5L+bV+amSu7Qmy","index");var o="update",r="level";cc.Class({extends:cc.Component,properties:{},onLoad:function(){var e=this;wx.onMessage(function(t){switch(console.log(t),t.action){case o:e.updateData()}})},start:function(){},setLevelData:function(){wx.setUserCloudStorage({KVDataList:[{key:r,value:"1"}],success:function(e){console.log("uploadScore success:res=>",e)},fail:function(e){console.log("uploadScore fail:res=>",e)}})},formatData:function(e,t){return e.forEach(function(e){var n=e.KVDataList.findIndex(function(e){return e.key===t});e[t]=-1===n?0:+e.KVDataList[n].value}),e=e.sort(function(e,n){return n[t]-e[t]})},updateData:function(){wx.getFriendCloudStorage({keyList:[r],success:function(e){console.log(e);var t=this.formatData(e.data,r);console.log(JSON.stringify(t))}})}}),cc._RF.pop()},{}],main:[function(e,t,n){"use strict";cc._RF.push(t,"2d25f6QSSBHgJIpsVzSzGOI","main"),Object.defineProperty(n,"__esModule",{value:!0});var o="update",r="level",a=cc._decorator,c=a.ccclass,i=a.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.itemPrefab=null,t.container=null,t.oneSp=null,t.twoSp=null,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;window.wx.onMessage(function(t){switch(console.log(t),t.action){case o:e.updateData()}})},t.prototype.start=function(){},t.prototype.setLevelData=function(){window.wx.setUserCloudStorage({KVDataList:[{key:r,value:"1"}],success:function(e){console.log("uploadScore success:res=>",e)},fail:function(e){console.log("uploadScore fail:res=>",e)}})},t.prototype.formatData=function(e,t){return e.forEach(function(e){var n=e.KVDataList.findIndex(function(e){return e.key===t});e[t]=-1===n?0:+e.KVDataList[n].value}),e=e.sort(function(e,n){return n[t]-e[t]})},t.prototype.updateData=function(){var e=this;window.wx.getFriendCloudStorage({keyList:[r],success:function(t){console.log(t);var n=e.formatData(t.data,r);console.log(n),e.renderData(n)}})},t.prototype.renderData=function(e){var t=this;this.container.removeAllChildren(),e.forEach(function(e,n){var o=cc.instantiate(t.itemPrefab);cc.find("right/label/nickname",o).getComponent(cc.Label).string=e.nickname,cc.find("rank_sp/level",o).getComponent(cc.Label).string=n+1,cc.find("right/label/level",o).getComponent(cc.Label).string=e[r]+"\u5173",0===n&&(o.getChildByName("rank_sp").getComponent(cc.Sprite).spriteFrame=t.oneSp),1===n&&(o.getChildByName("rank_sp").getComponent(cc.Sprite).spriteFrame=t.twoSp);var a=e.avatarUrl,c=cc.find("right/header",o);t.createImage(a,c),t.container.addChild(o)}),this.container.y=250,this.container.getComponent(cc.Layout).updateLayout(),this.container.getComponent(cc.Widget).updateAlignment()},t.prototype.createImage=function(e,t){if(cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB)try{var n=window.wx.createImage();n.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(n),e.handleLoadedTexture(),t.getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(e)}catch(e){cc.log(e)}},n.src=e}catch(e){cc.log(e)}},__decorate([i(cc.Prefab)],t.prototype,"itemPrefab",void 0),__decorate([i(cc.Node)],t.prototype,"container",void 0),__decorate([i(cc.SpriteFrame)],t.prototype,"oneSp",void 0),__decorate([i(cc.SpriteFrame)],t.prototype,"twoSp",void 0),t=__decorate([c],t)}(cc.Component);n.default=s,cc._RF.pop()},{}]},{},["index","main"]);